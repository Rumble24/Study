# TCP 长连接和 WebSocket 有以下区别：

协议层级：
TCP 长连接：位于传输层，是 TCP 协议本身提供的一种连接特性，主要通过在一定时间内保持 TCP 连接不被关闭来实现多次数据传输。
WebSocket：是基于 TCP 的应用层协议，借助 HTTP 协议进行握手，然后将连接升级为 WebSocket 连接，在单个 TCP 连接上实现全双工通信。
连接建立方式：
TCP 长连接：通过 TCP 三次握手直接建立连接。在应用层如 HTTP 协议中，通过设置 Connection: keep - alive 等相关字段来告知对方使用长连接。
WebSocket：先进行 HTTP 握手，客户端发送包含特殊请求头的 HTTP 请求，服务器返回 101 Switching Protocols 状态码表示同意升级协议，然后切换到 WebSocket 协议进行通信。
通信模式：
TCP 长连接：虽然是双向通信，但在应用层如果是类似 HTTP 协议，通常是客户端发起请求，服务器响应请求，服务器一般不会主动向客户端推送数据，除非在应用层实现了特定的推送机制。
WebSocket：支持全双工通信，客户端和服务器可以同时主动发送数据，双方都能在任意时刻向对方发送消息，更适合实时交互场景。
数据格式：
TCP 长连接：传输的是原始字节流，应用层需要自己定义数据格式和解析方式，来区分不同的消息和数据边界。
WebSocket：自带消息分帧机制，数据帧头部较小，在不包含扩展的情况下，服务器到客户端的头部大小为 2 至 10 字节，客户端到服务器还需加上 4 字节掩码，适合高频小数据传输，且能自动处理消息的分割和组装。
适用场景：
TCP 长连接：适用于高效传输大块数据的场景，如视频流、文件下载等，也适用于客户端和服务器有一定交互，但不要求服务器实时主动推送数据的场景。
WebSocket：专为实时互动场景设计，如在线游戏、实时聊天、直播间弹幕、协作工具中的多人同时编辑等，能更好地节省服务器资源和带宽，实现更实时的通讯。
实现复杂度：
TCP 长连接：在应用层实现时，如果需要服务器主动推送等功能，需要在应用层协议中自行设计和实现复杂的逻辑，包括连接管理、消息推送策略等。
WebSocket：相对来说，在实现实时双向通信功能时，由于协议本身提供了相关机制，实现复杂度相对较低，开发者可以更专注于业务逻辑的实现。

# 访问互联网时的路径决策
路由表里面存着 无数个 ip:路由地址  没有的话 传递给运营商的路由器里面
假设你用电脑（IP：192.168.1.100）访问百度（IP：180.101.50.188）：

电脑将数据包发给网关路由器（192.168.1.1）；
路由器提取目的 IP 180.101.50.188，查询路由表：
路由表中没有直接匹配180.101.50.188的条目，但有默认路由0.0.0.0/0，指向 WAN 口（连接光猫，进而连接运营商网络）；
路由器将数据包从 WAN 口转发给运营商的下一跳路由器；
运营商路由器通过动态路由协议（如 BGP）逐级转发，最终到达百度服务器所在的网络。


# 当手机发送数据到服务器时，
数据会经过 TCP/IP 协议栈的应用层、传输层、网络层、数据链路层、物理层逐层封装并传输。每一层对应的 “设备” 或 “组件” 既包括手机和服务器自身的软硬件，也包括中间的网络设备。以下是各层对应的具体角色：
## 1. 应用层（Application Layer）
核心设备 / 组件：手机上的应用程序、服务器上的应用程序。
手机端：如浏览器（处理 HTTP）、即时通讯 APP（处理 WebSocket）、邮件客户端（处理 SMTP）等，负责生成原始数据（如请求内容、消息文本）。
服务器端：如 Web 服务器（Nginx、Apache）、数据库服务器、应用服务器（处理业务逻辑）等，最终接收并处理应用层数据。
功能：定义应用程序间的数据交互规则（如 HTTP、FTP、DNS、SMTP 等协议），数据以 “消息” 或 “数据块” 形式存在。
## 2. 传输层（Transport Layer）
核心设备 / 组件：手机和服务器的操作系统内核（协议栈中的传输层模块）。
手机端：操作系统（如 Android 的 Linux 内核、iOS 的 Darwin 内核）中的 TCP/UDP 模块，负责添加传输层头部（如 TCP 的源端口、目的端口、序号、确认号等）。
服务器端：操作系统的 TCP/UDP 模块，负责解封装传输层头部，根据端口号将数据交给对应的应用程序（如 Web 服务器监听 80/443 端口）。
功能：提供端到端的数据传输服务（如 TCP 的可靠传输、UDP 的无连接传输），数据单位为 “段（Segment，TCP）” 或 “数据报（Datagram，UDP）”。
## 3. 网络层（Network Layer）- 至少20字节
核心设备 / 组件：
手机和服务器：操作系统内核的 IP 模块（属于协议栈），负责添加 IP 头部（源 IP、目的 IP、协议类型等）。
路由器：网络中间设备，工作在网络层，根据 IP 头部的目的 IP 地址查找路由表，转发数据包（Packet）到下一跳。
防火墙：部分防火墙工作在网络层，根据 IP 地址、协议类型等过滤数据包。
功能：实现跨网络的路由选择和数据包转发，数据单位为 “包（Packet）”。
## 4. 数据链路层（Data Link Layer）- 至少20字节
核心设备 / 组件：
手机和服务器的网卡（或无线模块）：手机的蜂窝网络模块（如 4G/5G 调制解调器）、Wi-Fi 芯片，服务器的有线网卡，负责添加数据链路层头部和尾部（如以太网的 MAC 地址、校验和；无线局域网的 802.11 帧头）。
交换机：工作在数据链路层，根据帧（Frame）的 MAC 地址转发数据（如局域网内的交换机）。
路由器的接口：路由器的每个网络接口（如以太网口、光口）也工作在数据链路层，接收帧后剥离链路层头部，交给网络层处理；转发时重新添加下一跳的链路层头部。
功能：在相邻设备间（如手机与路由器、路由器与交换机）传输数据，处理物理地址（MAC）和差错校验，数据单位为 “帧（Frame）”。
## 5. 物理层（Physical Layer）
### 4G/5G/ 核心设备 / 组件：
传输介质：如手机与基站之间的无线电波（4G/5G/Wi-Fi）、网线（双绞线）、光纤等。
物理层设备：手机的射频模块（将电信号转为无线电波）、基站的信号发射器、交换机 / 路由器的物理接口（如 RJ45 网口、光模块）、服务器的物理网卡接口。
功能：将数据链路层的帧转换为物理信号（电信号、光信号、无线电波）并传输，数据单位为 “比特（Bit）”。

### Wi-Fi / 组件：
手机的 Wi-Fi 射频模块：将 Wi-Fi 帧转换为 2.4GHz/5GHz 无线电波（物理信号），通过天线发送到路由器。
家庭路由器的 Wi-Fi 天线：接收无线电波，转换为电信号传递给路由器内部。
有线传输介质：路由器与光猫之间的网线（如双绞线）、光猫到运营商机房的光纤（传输光信号）、运营商网络中的电缆 / 光缆等。
服务器的物理网卡接口：将接收的电信号 / 光信号转换为二进制比特流，传递给数据链路层。
功能：将数据链路层的帧转换为物理信号（无线电波、电信号、光信号）并传输，数据单位为 “比特（Bit）”。


## IP数据 总长度不能超过1500字节
IP 数据包的数据部分不能超过 1500 字节，主要是由以太网的最大传输单元（MTU）决定的。
以太网数据帧的最大长度为 1518 字节，其中包含源 MAC 地址（6 字节）、目的 MAC 地址（6 字节）、类型字段（2 字节）和帧校验序列（FCS，4 字节），这些头部信息共 18 字节。因此，留给上层协议（如 IP）传输的数据部分最大长度为 1500 字节，这就是以太网的 MTU。
由于 IP 数据报需要封装在以太网帧中传输，所以 IP 数据报的总长度（包括 IP 头部和数据部分）不能超过 1500 字节。一般情况下，IP 首部长度为 20 字节，那么 IP 数据报的数据部分最大长度就是 1480 字节。如果要传输 UDP 数据报，UDP 首部占 8 字节，则 UDP 数据报的数据部分最大长度为 1472 字节。
如果 IP 数据包的数据部分超过了 1500 字节，就需要进行分片操作，将数据报分成若干个较小的片，使每一片的长度都小于或等于 MTU。分片和重组会增加网络设备的处理负担，降低传输效率，还可能导致数据包丢失或传输错误。因此，为了避免这些问题，通常会将 IP 数据包的数据部分控制在 1500 字节以内。
