#  沾包问题
‌TCP是面向字节流的协议，没有消息边界‌。发送方的多个小包可能被合并发送（粘包），或大包被拆分发送（拆包），接收方无法区分原始数据包的起始和结束。
解决：一般情况是 将消息分为头部和消息体 头部包含数据长度，供客户端解析正确的数据例如websocket就是这样

# 网络连接的7层协议 - 物联网叔会使用
物理层     - 路 - 它是专门用来发送高低电频的，高电频对应数字1，低电频对应数字0 (01)1010(10101110)101010(1010)
数据联络层  - mac 类似MD5 的唯一标识符 - 全世界的网络设备 MAC 地址都是唯一的，但无法通过 MAC 地址判断设备的位置（比如无法区分 “北京的设备” 和 “上海的设备”）
网络层     - IP地址 - 家的地址 端口号 哪个房间
传输层     - tcp/udp - 车
会话层
表示层     
应用层    - http

物理层 - 添加‌ - 比特流：将数据转换为电信号、光信号等物理形式，通过电缆、光纤等介质传输。 ‌
数据链路层 - 添加‌ - 帧：将数据封装成帧（包含源MAC地址、目标MAC地址、序列号等），并添加校验码（如CRC）确保传输可靠性。 ‌
网络层 - ‌添加‌ - 包：为数据包添加IP地址（IPv4/IPv6），通过路由算法选择路径，并处理IP寻址和转发。 ‌
传输层 - ‌添加‌ - 段：为数据流添加端口号（TCP/UDP），实现端到端可靠传输或实时传输。 ‌

会话层 - 添加‌：管理会话连接，维护数据同步和流量控制。 ‌
表示层 - 添加‌：对数据进行加密、压缩或格式转换（如ASCII、UTF-8编码），确保不同系统间兼容。 ‌
应用层 - 添加‌：根据具体应用需求（如HTTP、FTP、SMTP），定义协议细节，实现用户交互。

### 网卡，全称 “网络接口控制器”（Network Interface Controller，NIC），是计算机、手机、平板等电子设备连接网络的核心硬件组件。它负责将设备内部的数据转换为网络可传输的信号（如电信号、无线信号），并实现设备与网络之间的通信
数据转换 - 设备内部处理的是数字信号（二进制数据），而网络传输的可能是电信号（有线网络）、无线电波（无线网络）等。网卡的核心作用就是在这两种信号之间进行转换，确保数据能在设备和网络间正常传递
身份标识 - 包含 mac 地址
协议处理

# TCP 虽然是可靠传输 但是连接如果要是断了的话 还是不会重新传输数据的
### 连接的时候需要3次连接 
SYN：
英文全称：Synchronize Sequence Numbers（同步序列编号）14。
含义：是 TCP 建立连接时使用的握手信号。在客户机和服务器之间建立正常的 TCP 网络连接时，客户端首先发出一个 SYN 消息，这个消息用于向服务器请求建立连接，并告知服务器客户端的初始序列号，以便后续的数据传输能够按顺序进行。SYN 标志位在数据包的 TCP 头部中设置为 1 时，表示这是一个 SYN 数据包146。
作用：通过交换 SYN 消息，客户端和服务器可以同步双方的序列号，为后续的可靠数据传输建立基础。例如，客户端发送的 SYN 包中包含一个随机生成的初始序列号，服务器收到后会记录这个序列号，并在回复的 SYN+ACK 包中确认这个序列号，同时也告知客户端自己的初始序列号2。
ACK：
英文全称：Acknowledge Character（确认字符）2。
含义：在数据通信中，是接收站发给发送站的一种传输类控制字符，表示发来的数据已确认接收无误2。
作用：在 TCP 连接中，如果接收方成功地接收到数据，那么会回复一个 ACK 数据。ACK 信号通常有自己固定的格式和长度大小，由接收方回复给发送方。ACK 的值是期望收到的下一个序列号，即确认号等于已成功接收的字节数加 1。当发送方接收到 ACK 信号时，就知道之前发送的数据已经被正确接收，可以继续发送下一个数据；如果发送方没有收到 ACK 信号，那么可能会重发当前的数据包，也可能根据具体的网络协议停止传送数据2。
FIN
FIN（Finish）是用于终止 TCP 连接的标志位。当通信的一方想要结束连接时，会发送一个带有 FIN 标志位设置为 1 的 TCP 数据包。这是一种友好的关闭连接的方式，表示发送方已经没有数据要发送了，希望能够关闭这个 TCP 连接。
### 四次挥手 - 保证双方都断开连接

# 基于TCP协议实现的 应用层协议
### HTTP/HTTPS
用途：超文本传输协议，用于浏览器与服务器之间的网页数据传输（HTTP 明文，HTTPS 基于 TLS/SSL 加密）。
依赖 TCP 的原因：网页内容（HTML、图片、脚本等）需要完整、有序传输，否则会导致页面显示异常，TCP 的可靠性保证了这一点。
### FTP（文件传输协议）
用途：用于在客户端和服务器之间传输文件（上传、下载）。
依赖 TCP 的原因：文件传输要求数据无丢失、无错误，TCP 的重传机制可确保大文件传输的完整性。
### SMTP（简单邮件传输协议）
用途：用于发送电子邮件（从客户端到邮件服务器，或服务器之间转发）。
依赖 TCP 的原因：邮件内容（尤其是附件）需要完整送达，TCP 确保邮件数据不会因丢失而损坏。
### POP3（邮局协议版本 3）/IMAP（互联网消息访问协议）
用途：用于客户端从邮件服务器接收电子邮件（POP3 适合简单下载，IMAP 支持更复杂的邮件管理，如同步文件夹）。
依赖 TCP 的原因：邮件接收需要可靠传输，避免邮件内容缺失。
### Telnet/SSH
用途：远程登录协议（Telnet 明文，SSH 加密），用于远程控制服务器。
依赖 TCP 的原因：命令输入和执行结果的交互需要有序、可靠，否则可能导致操作错误。
### WebSocket
用途：在客户端和服务器之间建立持久化双向通信（如实时聊天、游戏交互）。
依赖 TCP 的原因：虽然侧重实时性，但需要基础的可靠性（如消息不丢失），TCP 为其提供稳定的底层连接。

# 基于UDP协议实现的 应用层协议
### DNS（域名系统）
用途：将域名（如 www.example.com）解析为 IP 地址。
依赖 UDP 的原因：DNS 查询通常数据量小（单个数据包即可完成），且对响应速度要求高，UDP 的低开销更适合；若查询数据量大，会 fallback 到 TCP。
### DHCP（动态主机配置协议）
用途：为设备自动分配 IP 地址、子网掩码等网络配置。
依赖 UDP 的原因：设备刚接入网络时无 IP 地址，无法建立 TCP 连接，UDP 的无连接特性使其可直接广播请求。
### RTP（实时传输协议）
用途：传输实时数据（如音频、视频），常见于 VoIP（网络电话）、视频会议。
依赖 UDP 的原因：实时流对延迟敏感，少量数据包丢失可通过算法补偿（如音频卡顿忽略、视频帧插值），而 TCP 的重传会导致延迟累积，反而影响体验。
### TFTP（简单文件传输协议）
用途：小型文件传输（如路由器固件更新），功能比 FTP 简单。
依赖 UDP 的原因：设计轻量，适合资源有限的设备，通过自身简单的确认机制弥补 UDP 的不可靠性。
### 游戏协议（如多人在线游戏）
用途：玩家动作同步、位置更新等实时交互。
依赖 UDP 的原因：游戏操作（如移动、射击）需要低延迟，过时的数据（如 100ms 前的位置）重传无意义，UDP 能保证实时性。

## WebRTC（Web Real-Time Communication，网页实时通信）是一套支持浏览器 / 应用程序进行实时音视频通话、数据共享的开源技术标准，其底层传输机制同时涉及 UDP 和 TCP，但核心实时媒体传输主要依赖 UDP，具体如下：

# TCP是如何实现可靠连接的
### 3次连接保证双方可以接收

### 序列号与确认机制

### 超时重传 - 超时时间/快速重传
快速重传凭借低延迟、高效率的特点，在实际网络中成为 TCP 处理丢包的主要方式，而超时重传更多作为 “最后手段”（当快速重传无法触发时）存在。两者配合使用，但快速重传的应用范围和频率远高于超时重传。

### 流量控制 - CP 通过 “滑动窗口” 限制发送方的发送速率，避免接收方因处理能力不足而丢包

### 拥塞控制
TCP 连接建立后，拥塞控制算法会按以下流程动态运行：

1.初始阶段：慢启动（Slow Start）
    连接刚建立时，TCP 对网络状况一无所知，为了避免突然发送大量数据导致拥塞，会采用慢启动策略：
    初始拥塞窗口（cwnd）很小（通常为 2~4 个 MSS）；
    每收到一个 ACK（确认），cwnd 就翻倍（指数增长）；
    当 cwnd 达到慢启动阈值（ssthresh） 时，进入 “拥塞避免” 阶段。
2.稳定阶段：拥塞避免（Congestion Avoidance）
    当 cwnd 超过 ssthresh 后，TCP 认为网络可能接近拥塞，切换到拥塞避免：
    cwnd 不再指数增长，而是每经过一个往返时间（RTT）增加 1 个 MSS（线性增长）；
    此阶段持续到网络出现拥塞信号（如丢包），触发 “拥塞发生” 处理。
3.异常处理：拥塞发生（Congestion Detection）
    当检测到丢包（如超时未收到 ACK，或收到 3 个重复 ACK），TCP 判断网络拥塞，执行拥塞发生处理：
    情况 1：超时重传（严重拥塞）：
    将 ssthresh 设为当前 cwnd 的一半（ssthresh = cwnd / 2）；
    重置 cwnd 为 1 个 MSS，重新进入慢启动阶段。
    情况 2：收到 3 个重复 ACK（轻微拥塞，可能是数据包丢失但网络仍可用）：
    将 ssthresh 设为当前 cwnd 的一半；
    重置 cwnd 为ssthresh + 3（3 个重复 ACK 对应 3 个已收到的数据包），进入快速恢复阶段。
4.快速恢复（Fast Recovery）
    仅在 “收到 3 个重复 ACK” 时触发，目的是快速恢复数据传输，减少吞吐量下降：
    认为网络只是丢失个别包，而非严重拥塞，因此不回到慢启动，而是保持较大的 cwnd；
    每收到一个重复 ACK，cwnd 增加 1 个 MSS；
    当收到新的 ACK（确认了丢失的包之后的数据包），将 cwnd 设为 ssthresh，回到拥塞避免阶段。
    总结：四个算法的关系
    必须使用：慢启动和拥塞避免是 TCP 拥塞控制的基础，所有 TCP 实现都会用到（除非特殊配置）。
    按需触发：拥塞发生处理是网络出现拥塞时的响应机制，而快速恢复是 “收到 3 个重复 ACK” 时的优化策略（属于拥塞发生处理的一个分支）。

简单说：TCP 连接会先通过慢启动快速提升发送速率，达到阈值后进入拥塞避免稳步增长；一旦发生拥塞，通过拥塞发生处理调整参数，若条件满足则进入快速恢复，否则重新慢启动。这四个算法形成一个闭环，根据网络状态动态切换，实现 “既高效利用带宽，又避免网络拥塞” 的目标。
